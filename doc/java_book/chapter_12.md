# 第十二章 - 输入/ 输出流

在程序运行时，可能需要输入一些原始数据；程序运行结束后，要将数据处理的结果永久保存。Java 中提供的 I/O (输入/输出) 流技术可以使数据在不同设备之间进行传送，通过输入流可以方便地从输入设备中获得数据，通过输出流可以容易地将数据传送到存储设备中。Java 的 NIO 类库为文件访问提供了非阻塞的基于缓冲区的处理方式，性能和效率都有所提升。

## 12.1 流的概述

### 12.1.1 流的概念

Java 是通过 I/O 流技术完成数据读写操作的。流是由无结构化的数据组成的序列，流中的数据没有任何格式和含义，只是以字节或字符形式进行流入或流出。数据流的流入和流出都是以程序本身作为核心：

- 输入流 （读操作） 从外部数据源流入程序内部
- 输出流 （写操作）数据从程序内部向外部流出到数据的目的地

无论是流入还是流出，其数据都是通过一个管道进行的，管道两端分别连接数据源和数据目的地。流的本质就是进行数据传输，因此 Java 根据数据传输的特性将流抽象成各种类，以方便进行数据操作。

![image-20230927215632698](https://yong-gan-niu-niu-1311841992.cos.ap-beijing.myqcloud.com/images/image-20230927215632698.png)

### 12.1.2 流的分类

- 根据待处理数据类型的不同，流可以分为字节流和字符流
- 根据数据的流向不同，流可以分为输入流和输出流
- 根据处理数据功能的不同，流可以分为实体流和装饰流
  - 实体流：实体流对数据不做任何处理，只完成基本的读写操作包括：
    - 字节流
    - 字符流
  - 装饰流：装饰流是在实体流的基础上，提供更高级的功能，例如提供缓存处理、将多个流合并处理等

- **字节流**

字节流是指在数据传输过程中以字节为单位进行输入和输出。它是一种实体流，不对数据作任何处理，是用于传输各种类型的文件或数据。

在字节输入流中，InputStream 类是所有输入字节流的父类，它是一个抽象类。其子类中的 ByteArrayInputStream、FileInputStream 是两种基本的实体流，它们分别从 Byte 数组和本地文件中读取数据。PipedInputStream 从与其他线程共用的管道中读取数据。ObjectInputStream 和所有 FilterInputStream 的子类都是装饰流，这些流在实体流的基础上进行数据加工以满足特定需求。

在字节输出流中，OutputStream 是所有输出字节流的父类，它是一个抽象类。Byte Array Output Stream和所有 FilterOutputStream 是两种基本的实体流，它们分别向 Byte 数组和本地文件写入数据。PipedOutputStream 向与其他线程共用的管道中写入数据，ObjectOutputStream 和所有 FilterOutputStream 的子类都是装饰流。

![image-20230927221929589](https://yong-gan-niu-niu-1311841992.cos.ap-beijing.myqcloud.com/images/image-20230927221929589.png)

![image-20230927221951963](https://yong-gan-niu-niu-1311841992.cos.ap-beijing.myqcloud.com/images/image-20230927221951963.png)



- **字符流**

字符流是指在数据传输过程中以字符为单位进行输入和输出。根据字符编码表，一个字符占用两个字节，因此字符流只适用于字符类型数据的处理。字符流也属于实体流。

在字符输入流中，Reader 是所有输入字符流的父类，它是一个抽象类。InputStreamReader 是一个连接字节流和字符流的 桥梁 ，它使用指定的字符集读取字节并将其转换成字符。其 FileReader 子类可以更方便地读取字符文件，也是常用的 Reader 流对象。ChartArrayStream 和 StringReader 也是基本的实体流，它们可以从 char 数组和 String中读取原始数据。BufferReader 是装饰流，用于实现具有缓存区的数据输入。FilterReader 是具有过滤功能的类，其子类 PushbackReader 可以对 Reader 对象进行回滚处理。PipedReader 从与其他线程共用的管道中读取数据。

在字符输出流中，Writer 是所有输出字符流的父类，也是一个抽象类。相较于输入流的子类，输出流中也有相应的输出子类，只是数据传输方向相反，这些类有 OutputStreamReader 及其子类 FileWriter、CharArrayWriter、StringWriter、BufferWriter、PipedWriter 等。

掌握输入输出流及其特点，可以帮助我们根据需要选择合适的类进行数据的输入和输出。

![image-20230927222242238](https://yong-gan-niu-niu-1311841992.cos.ap-beijing.myqcloud.com/images/image-20230927222242238.png)

![image-20230927222357228](https://yong-gan-niu-niu-1311841992.cos.ap-beijing.myqcloud.com/images/image-20230927222357228.png)

## 12.2 File 类

如果想访问磁盘上的文件系统，程序员就需要使用 File 类。File 类的对象被用来表示文件的一些基本信息，如文件名称、所在路径、文件大小等，它不会对文件进行读写操作。目录（文件夹）也是 File 类的对象。

### 12.2.1 文件对象与文件属性

文件用文件类的对象表示，有了文件对象就可以获取文件的属性。

File 类的常用构造方法和获取属性的方法：

TODO

```java
```



### 12.2.2 目录

Java 把目录作为一种特殊的文件进行处理。它除了具备文件的基本属性，如文件名、所在路径等信息意外，也提供了专用于目录的一些操作方法。

目录操作的常用方法：

TODO



在获取文件时，如果只想获取特定类型的文件 （例如 只获取扩展名为 .java 的文件），则可以使用带过滤器的方法。

过滤器 FileFilter 接口和 FilenameFilter 都可以对获取到文件名进行过滤。这两个接口中都只有一个方法，FileFilter 接口中的方法如下：

```java
boolean accept(File pathname)
```

FilenameFilter 接口中的方法如下

```java

```

这两个接口只是方法参数不用，所以可以选择合适的过滤器进行过滤。

```java

```

### 12.2.3 文件的操作

对文件的操作主要有在磁盘上创建新文件、删除文件、运行可执行文件等，Java 中提供了相应的方法来实现这些操作。

- 创建新文件

File 类中创建新文件的方法如下：

```java
```

例如，要想在 D 盘根目录下创建一个 hello.txt 文件，则先由 File 创建一个文件对象，代码如下：

```java

```

- 删除文件

File 类中删除文件的方法如下：

```java
```

例如，对上述的 hello.txt 文件可以使用以下语句删除：

```java

```

- 运行可执行文件

要想运行磁盘上的可执行文件，此时需要使用 java.lang.Runtime 类。先利用 Runtime 类的静态方法创建一个 Runtime 对象，代码如下：

```java

```

然后用 ec 调用一下方法

```java
```

该方法用于执行本地的命令，参数 command 为指定的系统命令

例如： 执行记事本命令，打开一个新记事本：

```java

```

### 12.2.4 Scanner 类与文件

2.2. 小节和 9.1.3 小节分别讲解了 Scanner 类的用法。此外，利用 Scanner 类的对象还可以从文件中读取数据，如果要从文件中读数据，则应采用下面的形式实例化一个 Scanner 类的对象：

```java
```

创建的 Scanner 类的对象仍然用表 2.3 中的方法从文件中读数据。读数据时默认以空格作为数据的分割标记。

例如：有一个购物清单：电视机 3200.00 元、只能收i就 2200.00 元、笔记本 4200.00 元，午餐 120.25 元，现统计该次购物共花费多少。该购物清单存放在文件 record.txt 中。

```java

```

## 12.3 实体流

上述中已经提到实体流i包括字节流和字符流。下面对它们分别进行介绍。

### 12.3.1 字节流

字节流提供了处理字节的输入方法和输出方法，例如读写二进制数据时就只能使用字节流。抽象类 InputStream 和抽象类 OutputStream 是所欲字节流的根类，其他字节流都继承自这两个类，这些子类为数据的 输入和输出提供了多种不用的功能。

- 字节输入流类 InputStream

字节输入流的作用是从数据输入源 （例如：磁盘、网盘）获取字节数据到应用程序（内存）中。

InputStream 类的常用方法：

TODO

- 文件字节输入流类 FileInputStream

在进行字节输入流操作时，经常使用的是 InputStream 类的子类 FileInputStream，以实现简单的文件数据读取。

FileInputStream 类的常用构造方法如下：

TODO

它们分别通过给定的 File 对象和文件创建文件字节输入流对象。在创建输入流时，如果文件不存在或出现其他问题，系统会抛出 FileNotFoundException 异常，所以此时要注意捕获。

通过字节输入流读数据时，程序应首先设定输入流的数据源，然后创建指向这个数据源的输入流，再从输入流中读取数据，最后关闭输入流。

例如：从磁盘文件中读取指定文件并输出

- 字节输出流类 OutputStream

字节输出流的之作用是将字节数据从应用程序 （内存）中传送到输出目的地，如外部设备、网络等。

OutputStream 类中的常用方法：

TODO

- 文件字节输出流类 FileOutputStream

在啊进行字节输出流操作时，经常使用的是 OutputStream 下的 FileOutputStream ，它用于将数据写入 File 或其他的输出流。

FIleOutputStream 类的常用构造方法如下：

TODO

在创建输出流时，如果文件不存在或出现其他问题，系统会抛出 IOException 异常，所以此时要注意捕获。

通过字节输出流输出数据时，应首先设定输出流的目的地，然后创建指向这个目的地的输出流，再向输出流中写入数据，最后关闭输出流。

关闭输出流很重要。在完成写操作的过程中，系统会将数据暂存到缓存区中，缓存区存满后再一次性写入输出流中。执行 close ()  方法时，不管缓存区是否已满，系统都会把其中的数据写到输出流，从而保证数据的完整性。如果不执行 close() 方法，则输出的数据中有些不能保存到目的地中。

例如： 想弄一个磁盘文件中写入数据，第二次写操作采用追加方法完成。

```java

```

### 12.3.2 字符流

Java 规定一个字符占用两个字节，因此使用字节流进行传输时，一旦编码不当，会产生乱码的情况，为此，Java 提供了专门的字符流来完成字符的输入和输出，所以字符流通常用于文本文件的传输，抽象类 Reader 和抽象类 Writer 是所有字符流的根类，其他字符流类都继承自这两个类，其中一些子类还在传输过程中对数据做了进一步处理以方便用户的使用。

- 字符输入流类 Reader

字符输入流类 Reader 是所有字符输入流类的父类，它提供了一系列方法用于实现从数据源读入字符数据的操作。

Reader 类中的常用方法：

TODO

- 文件字符输入流类 FileReader

与字节输入流类似，在进行字符输入流操作时，经常使用的是 Reader 类的子类 FileReader ，它用于从输入流读取数据。FileReader 类与文件字节输入流类 FileInputStream 对应，其构造方法也很相似。

FileReader 类的常用构造方法如下：



通过给定的 file 对象或文件名创建字符输入流。在创建输入流时，如果文件不存在或出现其他问题，系统会抛出 FileNotFoundException 异常

- 字符输出流类 Writer

字符输出流类 Writer 用于将字符数据输出到目的地。

Writer 类中的常用方法：

TODO



- 文件字符输出流类 FileWriter

FileWriter 类和文件字节输出流类 FileOutputStream 相对应，只是变成了字符的输出操作，实现方法也基本相同。

FIleWriter 类的常用构造方法如下：



它们分别通过给定的 File 对象或文件名创建字符输出流。如果第二个参数值为 true，则将字符写入文件末尾处，而不是写入文件开始处。在创建输出流时，如果文件不存在或出现其他问题，系统会抛出 IOException 异常。

## 12.4 装饰流

装饰流实在实体流的基础上对原始数据的进一步加工和处理，极大地方便了用户的访问和使用。根据不同的应用需求，装饰流分为：

- 数据流
- 缓冲流
- 随机流
- 对象流

### 12.4.1 数据流

数据流是 Java 提供的一种装饰类流。它建立在实体流基础上，让程序在不需要 “考虑” 数据所占字节个数的情况下就能够正确地完成读写操作。DataInputStream 类和 DataOutputStream 类分别为数据输入流类和数据输出流类。

- 数据输入流

数据输入流类 DataInputStream 允许程序以与机器无关的方式从底层输入流中读取 Java 基本数据类型。

DataInputStream 类中的常用方法。

TODO

- 数据输出流

数据输出流允许程序以适当方式将 Java 基本数据类型写入输出流这种。与数据输入流向配合，应用程序可以很方便地按数据类型完成数据的读写操作，而无需 “考虑” 格式和占用空间的问题。

DataOutputStream 类中的常用方法：

TODO

例如：将几个 Java 基本数据类型的数据写入一个文件中，再将其读取后输出。

```java
```



### 12.4.2 缓冲流

缓冲流在实体 I/O 流基础上增加一个缓冲区，应用程序和 I/O 设备之间的数据传输都要经过缓冲区来进行。缓冲流分为缓冲输入流和缓冲输出流。缓冲输入流是将从输入流读入的字节/字符数据先存在缓冲区中，应用程序从缓冲区而不是从输入流读取数据；缓冲输出流是在进行数据输出时先把数据存在缓冲区中，当缓冲区满时再一次性写到输出流中。

使用缓冲流可以减少应用程序与 I/O 设备之间的访问次数，提高传输效率；可以对缓冲区中的数据进行按需访问和处理，增加访问的灵活性。

- 缓冲输入流

缓冲输入流包括字节缓冲输入流类 BufferdeInputStream 和字符缓冲输入流类 BufferedReader。

1. BufferedInputStream 类

字符缓冲输入流类 BufferedInputStream 在进行输入操作时，先通过实体输入流 （例如 FileInputStream 类）对象逐一读取字节数据并存入缓冲区，应用程序则从缓冲区中读取数据。BufferedInputStream 类的构造方法如下：



第一个构造方法创建一个默认大小输入缓冲区的缓冲字节输入流对象，第二个构造方法创建一个指定大小的输入缓冲区的缓冲字节输入流对象。

BufferedInputStream 继承自 InputStream 类，所以该类的方法与 InputStream 类的方法相同。

2. Buffered 类

字符缓冲输入流 BufferedReader 类与字节缓冲输入流类 BufferedInputStream 在功能和实现上基本相同，但它只适用于字符读入。在输入时，该类提供了按字符、数组和行进行高效读取的方法。

BufferedReader 类的构造方法如下：



第一个构造法昂发创建一个使用默认大小输入缓冲区的缓冲字符输入流对象，第二个构造方法创建一个使用指定大小输入缓冲区的缓冲字符输入流对象。

BufferedReader 类继承自 Reader 类，所以该类的方法与 Reader 类的方法相同。除此之外，还增加了按行读取的方法，如下所示：



读一行时，以字符换行 （'\n'）、回车 ('\r') 或回车后最直接跟换行符作为行结束符。该方法返回值为改行不包含结束符的字符串内容；如果已到达流末尾，则返回 null。



- 缓冲输出流

缓冲输出流包括字节缓冲输入流类 BufferedOutputStream 和字符缓冲输出流类 BufferedWriter。

1. BufferedOutputStream

字节缓冲输出流 BufferedOutputStream 在完成输出操作时，先将字节数据存入缓冲区，缓冲区满后，再把缓冲区中的所有数据一次性写道底层输出流中。 BufferedOutputStream 类的构造方法如下：



第一个构造方法创建一个使用默认大小输出缓冲区的缓冲字节输出流对象，第二个构造方法创建一个使用指定大小输出缓冲区的缓冲字节输出流对象。



2. BufferedWriter 类

字符缓冲输出流类 BufferedWriter 与字节缓冲输出流类 BufferedOutputStream 在功能和实现上时相同的，但它只适用于字符输出。在输出时，该类提供了按单个字符、数组和字符串的高校输出方法。BufferedWriter 类的构造方法如下：



第一个构造方法创建一个使用默认大小输出流的缓冲字符输出流对象，第二个构造方法创建一个使用指定大小输出缓冲区的缓冲字符输出流对象。

BufferedWriter 类继承自 Writer 类，所以该类的方法与 Writer 类的方法相同。除此以外，其增加了写行分隔符的方法，如下所示：



行分隔符字符串由系统属性 line.separator 定义



例如：向指定文件写入内容，并重新读取该文件的内容：

```java
```



### 12.4.3 随机流

- 随机流的概念

在前面学习的输入流、输出流中，每个流类都只能单向传输。如果对一个文件既要进行输入操作也要进行输出操作，此时就需要建立两个流，而流可以同时实现输入和输出。

随机流类 RandomAccessFile 创建的对象既可以作为输入流，也可以作为输出流，因此建立一个随机流就可以完成读写操作。

RandomAccessFile 类与其他流不同，它既不是 InputStream 类的子类，也不是 OutputStream 类的子类，而是 java.lang.Object 根类的子类。

RandomAccessFile 类的实例对象支持随机访问文件时的读取和写入。随机访问文件的过程可以看作访问文件系统中的一个大型 Byte 数组，指向数组位置的隐含指针成为文件指针。输入操作从文件指针开始读取字节，并随着对字节的读取而移动此文件指针。输出操作从文件指针开始写入字节，并随着对字节的写入而移动此文件指针。

随机流可以用于多线程下载或多个线程同时写数据到文件，为快速完成访问提供了便利。

- RandomAccessFile 流类

由于利用 RandomAccessFile 类的对象既可以读数据，又可以写数据，所以该类中既有读操作的方法，也有写操作的方法。

RandomAccessFile 类中的常用方法：



例如：以随机流的方式完成文件的读写操作。



- 字符乱码的处理

当进行字符串读取的时候，有时候会出现 乱码 的现象，这是因为存取时所使用的编码格式不同。要想解决这一问题，我们就需要对字符串重新进行编码。

重新编码时，先读取字符串：



再将字符串回复成标准字节数组：



最后将字节数组按当前及其的默认编码重新转换为字符串：



经过重新编码后就能够显示正确的字符串内容。如果想显示地指明编码类型，我们也可以直接给出编码类型：





### 12.4.4 对象流

通过前面学习的 I/O 流，可以实现多种数据类型的输入和输出操作，其中包括整型、实型、字符型等。但是对象作为一种复合数据类型，却无法使用这些流来完成 I/O 操作。因为对象中不仅包括多种不同类型的属性数据，还有跟类有关的信息，所以简单的流处理无法实现对象的传输和永久保存，为此，Java 提供了对象流和对象序列化机制来保证对象作为一个整体进行 I/O 流传输。

- 对象流的概念

对象流在实体流的基础上，通过对对象数据的处理和变换实现对对象的永久保存和读取。 ObjectInputStream 和 ObjectOutputStream 分别时对象输入流类和对象输出流类，它们也是 InputStream 和 OutputStream 的子类。对象输出流类可以把对象写入文件或进行网络传输，而对象输入流类则可以从文件或网络上把读取的数据还原成对象。但要实现对象的传输，待传输的对象要先进行序列化处理，才能保证对象能被准确地保存和读取。

- 对象的序列化

对象的序列化是指把对象转换成字节序列的过程，而把字节序列回复为对象的过程称为对象的反序列化。

一个类如果实现了 java.io.Serializable 接口，这个类的实例 （对象）就是一个序列化的对象。Serializable 接口中没有方法，因此实现该接口的类不需要额外实现其他的方法。当实现了该接口的对象进行输出时，JVM 将按照一定的格式 （序列化信息）转换成字节进行传输和存储到目的地。当对象输入流从文件或网络上读取对象时，会先读取对象的序列化信息，并根据这一信息创建对象。

实现了序列化接口的类中会有一个 long 行的静态常用 serialVersionID，这个值用于识别具体的类。如果并不设置，JVM 会自动分配一个值。为了保证类的准确识别，在定义类时应显示设置该值。

- 对象输入流与对象输出流

1. 对象输入流

ObjectInputStream 类可以实现对象的输入操作。其构造方法如下：



创建从指定输入流读取的 ObjectInputStream。类中的方法如下：



该方法用于从 ObjectInputStream 流中读取对象。	



2. 对象输出流类 ObjectOutputStream

ObjectOutputStream 类可以实现对象的输出操作。其构造方法如下：



该方法用于创建写入指定输出流的 ObjectOutputStream 对象。类中的方法如下：



该方法用于将指定对象 o 写入 ObjectOutputStream 流中。



例如：创建一个可序列化类，将该类的对象写入文件中。用对象输出流输出对象信息：



## 12.5 NIO 库

### 12.5.1 java.nio.file 类库

### 12.5.2 NIO / IO

### 12.5.3 NIO 的主要组成部分

### 12.5.4 Buffers

### 12.5.5 Channels

## 12.6 小结

 

## 12.7 习题